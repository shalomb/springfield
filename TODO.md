# TODO: EPIC-010 (Agent Command Migration)

Port shell-based agent recipes to type-safe Go runners within the Springfield binary.

---

## üèóÔ∏è Phase 1: Infrastructure & Prompts

### [refactor] Extract agent prompts to external markdown files
- **Task:** Move `PROMPT_RALPH`, `PROMPT_LISA`, `PROMPT_BART`, and `PROMPT_LOVEJOY` from `Justfile` to `.github/agents/prompt_{agent}.md`.
- **Reason:** Prompts are too large for `Justfile` variables and are hard to maintain/edit.
- **Success Criteria:** Files exist, and `Justfile` remains functional (for now) using `cat` or similar (or we just jump to the next task).
- **ACP:** `docs(agent): extract prompts to markdown files`

### [feat] Define Agent Runner interface and Base Runner
- **Task:** Create `internal/agent/runner.go` with a `Runner` interface and a `BaseRunner` struct that handles common logic (loading prompts, LLM interaction).
- **Reason:** Consistency across agents.
- **Success Criteria:** `Runner` interface defined and `BaseRunner` has a `Run()` method that loads a prompt.
- **ACP:** `feat(agent): add runner interface and base implementation`

---

## üèóÔ∏è Phase 2: Specialized Runners

### [feat] Implement RalphRunner with multi-iteration loop
- **Task:** Create `internal/agent/ralph_runner.go`. Port the logic from `Justfile`'s `ralph` recipe:
    - Loop until `TODO.md` is empty/removed AND no uncommitted changes.
    - Check for `TODO.md` existence and append to context.
    - Post-execution: log `ralph_done` to `td` if work is complete.
- **Reason:** Move fragile shell loop to Go.
- **Success Criteria:** Unit tests for `RalphRunner` demonstrate loop control and completion signaling.
- **ACP:** `feat(agent): implement ralph runner with autonomous loop`

### [feat] Implement LisaRunner with context injection
- **Task:** Create `internal/agent/lisa_runner.go`. Port logic from `Justfile`'s `lisa` recipe:
    - Load `FEEDBACK.md` if it exists.
    - Load `PLAN.md` as context.
    - Inject `EXTRA_INSTRUCTION` (user input).
- **Reason:** Formalize Lisa's role as the intelligent pre-processor.
- **Success Criteria:** `LisaRunner` correctly aggregates context files before LLM call.
- **ACP:** `feat(agent): implement lisa runner with context aggregate`

### [feat] Implement Bart & Lovejoy Runners
- **Task:** Create `internal/agent/bart_runner.go` and `internal/agent/lovejoy_runner.go`.
    - `BartRunner`: Runs tests, checks for `FEEDBACK.md` issues, logs `bart_ok` or `bart_fail`.
    - `LovejoyRunner`: Verifies `TODO.md` empty, performs merge (mock for now if needed), logs completion.
- **Reason:** Complete the agent migration.
- **Success Criteria:** Both runners log appropriate signals to `td`.
- **ACP:** `feat(agent): implement bart and lovejoy runners`

---

## üèóÔ∏è Phase 3: CLI & Cleanup

### [feat] Wire runners to `springfield agent` command
- **Task:** Update `cmd/springfield/main.go` to use the specialized runners based on the `--agent` flag.
- **Reason:** Single entry point for all agent execution.
- **Success Criteria:** `springfield agent ralph --task "..."` executes the Go-based Ralph loop.
- **ACP:** `feat(cli): wire specialized agent runners to agent command`

### [refactor] Update Justfile to use new runners
- **Task:** Replace existing agent recipes in `Justfile` with thin wrappers around `springfield agent`.
- **Reason:** Retire fragile shell recipes.
- **Success Criteria:** `just ralph`, `just lisa`, etc. work identically to before but use Go runners.
- **ACP:** `refactor(justfile): delegate agent execution to springfield binary`

### [chore] Final Cleanup
- **Task:** Remove old prompt variables and `npm exec` logic from `Justfile`. Update documentation.
- **Success Criteria:** `Justfile` is clean and focused on task runners.
- **ACP:** `chore(cleanup): remove legacy shell-based agent logic`

---
*Generated by Lisa Simpson (Planning Agent)*
