# TODO.md

## üéØ Active Tasks

- [x] **[FIX] Patch `Justfile` keyword-matching fragility**
  - **Context:** Bart found that `grep -qiE "critical|blocker|rejected|fail"` in the `Justfile` causes false positives.
  - **Action:** Update `bart` and `lovejoy` recipes in `Justfile` to use: `grep -qE "Status:.*REJECTED|BLOCKED|‚ùå.*Verdict"`.
  - **Success Criteria:** `just bart` should pass if `FEEDBACK.md` contains explanatory text with the word "critical" but not the actual Status line.
  - **ACP:** `fix: use stricter regex for feedback evaluation in Justfile`

- [x] **[FEAT] Implement decision logging in Agent loop**
  - **Context:** The orchestrator relies on `td` decisions (e.g., `ralph_done`, `bart_ok`) to transition states. Currently, agents have no easy way to signal completion to the orchestrator.
  - **Action:** Ensure agents are instructed (via prompt or tool) to log decisions using `td log <epic-id> <decision> --decision`.
  - **Success Criteria:** An agent can successfully log a decision (e.g., `ralph_done`) that the orchestrator can then detect via `o.hasDecision`.
  - **ACP:** `feat: enable agents to log decisions to td`

- [x] **[FEAT] Enhance `orchestrate` loop with Lisa invocation**
  - **Context:** Currently `processEpic` in `internal/orchestrator/orchestrator.go` has a TODO/comment for invoking Lisa when blocked, and doesn't handle the `Planned` -> `InProgress` transition via Lisa.
  - **Action:** Ensure Lisa is invoked when an epic is in `StatusPlanned` or `StatusBlocked`.
  - **Success Criteria:** `springfield orchestrate` calls Lisa for new or blocked epics to generate a `TODO.md`.
  - **ACP:** `feat: invoke Lisa in orchestrator for planning and blocked states`

- [x] **[REFACTOR] Standardize Agent Handoff Context**
  - **Context:** ADR-008 mentions `TODO-{id}.md` for handoff. The orchestrator's `Worktree.DepositHandoff(id)` should be verified.
  - **Action:** Ensure the orchestrator correctly deposits the `TODO.md` (from Lisa) into the workspace before Ralph starts.
  - **Success Criteria:** Ralph receives the `TODO.md` generated by Lisa for the specific epic.
  - **ACP:** `refactor: standardize handoff context protocol for agents`

## üìã Backlog

- [ ] **[OPTIMIZE] Logger buffered writer**
  - **Context:** `pkg/logger` currently opens/closes files too frequently.
- [ ] **[TEST] Integration test for full Go orchestration loop**
  - **Context:** Ensure the Go orchestrator can drive an Epic from start to finish.
